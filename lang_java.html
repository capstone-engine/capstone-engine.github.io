<!DOCTYPE html>
<html>
  <head>
    <title>Programming with Java language – Capstone – The Ultimate Disassembler</title>

        <meta charset="utf-8" />
    <meta content='text/html; charset=utf-8' http-equiv='Content-Type'>
    <meta http-equiv='X-UA-Compatible' content='IE=edge'>
    <meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1.0'>

    
    <meta name="description" content="The Ultimate Disassembler">
    <meta property="og:description" content="The Ultimate Disassembler" />
    
    <meta name="author" content="Capstone" />

    
    <meta property="og:title" content="Programming with Java language" />
    <meta property="twitter:title" content="Programming with Java language" />
    

    <link rel="icon" type="image/png" sizes="16x16" href="/16x16.png">
    <link rel="icon" type="image/png" sizes="24x24" href="/24x24.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/32x32.png">
    <link rel="icon" type="image/png" sizes="48x48" href="/48x48.png">
    <link rel="icon" type="image/png" sizes="64x64" href="/64x64.png">
    <link rel="icon" type="image/png" sizes="96x96" href="/96x96.png">
    <link rel="icon" type="image/png" sizes="128x128" href="/128x128.png">
    <link rel="icon" type="image/png" sizes="256x256" href="/256x256.png">
    <link rel="icon" type="image/png" sizes="512x512" href="/512x512.png">
    <link rel="manifest" href="/manifest.json">
    <meta name="msapplication-TileColor" content="#ffffff">
    <meta name="msapplication-TileImage" content="/ms-icon-144x144.png">
    <meta name="theme-color" content="#ffffff">


    <!--[if lt IE 9]>
      <script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <link rel="stylesheet" type="text/css" href="/style.css" />
    <link rel="alternate" type="application/rss+xml" title="Capstone - The Ultimate Disassembler" href="/feed.xml" />

    <!-- Created with Jekyll Now - http://github.com/barryclark/jekyll-now -->
  </head>

  <body>
    <div class="wrapper-masthead">
      <div class="container">
        <header class="masthead clearfix">
          <a href="/" class="site-avatar"><img src="/img/capstone.png" /></a>

          <div class="site-info">
            <h1 class="site-name"><a href="/">Capstone</a></h1>
            <p class="site-description">The Ultimate Disassembler</p>
          </div>

          <nav>
            <a href="/download.html">Download</a>
            <a href="/documentation.html">Docs</a>
            <a href="/showcase.html">Showcase</a>
            <a href="/testimonial.html">Testimonials</a>
            <a href="/donate.html">Donate</a>
            <a href="/contact.html">Contact</a>
          </nav>
        </header>
      </div>
    </div>

    <div id="main" role="main" class="container">
      <h2>Java tutorial for Capstone</h2>

<h3>1. Basic sample</h3>

<p>Capstone has a very simple API, so it is very easy to write tools using the framework. To start, the below code disassemble some X86 binary, and print out its assembly.</p>

<div class="highlight"><pre><code class="language-java" data-lang="java"><span class="lineno"> 1</span> <span class="c1">// Test.java</span>
<span class="lineno"> 2</span> <span class="kn">import</span> <span class="nn">capstone.Capstone</span><span class="o">;</span>
<span class="lineno"> 3</span> 
<span class="lineno"> 4</span> <span class="kd">public</span> <span class="kd">class</span> <span class="nc">Test</span> <span class="o">{</span>
<span class="lineno"> 5</span> 
<span class="lineno"> 6</span>   <span class="kd">public</span> <span class="kd">static</span> <span class="kt">byte</span> <span class="o">[]</span> <span class="n">CODE</span> <span class="o">=</span> <span class="o">{</span> <span class="mh">0x55</span><span class="o">,</span> <span class="mh">0x48</span><span class="o">,</span> <span class="o">(</span><span class="kt">byte</span><span class="o">)</span> <span class="mh">0x8b</span><span class="o">,</span> <span class="mh">0x05</span><span class="o">,</span> <span class="o">(</span><span class="kt">byte</span><span class="o">)</span> <span class="mh">0xb8</span><span class="o">,</span>
<span class="lineno"> 7</span>     <span class="mh">0x13</span><span class="o">,</span> <span class="mh">0x00</span><span class="o">,</span> <span class="mh">0x00</span> <span class="o">};</span>
<span class="lineno"> 8</span> 
<span class="lineno"> 9</span>   <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span> <span class="n">argv</span><span class="o">[])</span> <span class="o">{</span>
<span class="lineno">10</span>     <span class="n">Capstone</span> <span class="n">cs</span> <span class="o">=</span> <span class="k">new</span> <span class="nf">Capstone</span><span class="o">(</span><span class="n">Capstone</span><span class="o">.</span><span class="na">CS_ARCH_X86</span><span class="o">,</span> <span class="n">Capstone</span><span class="o">.</span><span class="na">CS_MODE_64</span><span class="o">);</span>
<span class="lineno">11</span>     <span class="n">Capstone</span><span class="o">.</span><span class="na">CsInsn</span><span class="o">[]</span> <span class="n">allInsn</span> <span class="o">=</span> <span class="n">cs</span><span class="o">.</span><span class="na">disasm</span><span class="o">(</span><span class="n">CODE</span><span class="o">,</span> <span class="mh">0x1000</span><span class="o">);</span>
<span class="lineno">12</span>     <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="o">;</span> <span class="n">i</span><span class="o">&lt;</span><span class="n">allInsn</span><span class="o">.</span><span class="na">length</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span>
<span class="lineno">13</span>       <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">printf</span><span class="o">(</span><span class="s">&quot;0x%x:\t%s\t%s\n&quot;</span><span class="o">,</span> <span class="n">allInsn</span><span class="o">[</span><span class="n">i</span><span class="o">].</span><span class="na">address</span><span class="o">,</span>
<span class="lineno">14</span>           <span class="n">allInsn</span><span class="o">[</span><span class="n">i</span><span class="o">].</span><span class="na">mnemonic</span><span class="o">,</span> <span class="n">allInsn</span><span class="o">[</span><span class="n">i</span><span class="o">].</span><span class="na">opStr</span><span class="o">);</span>
<span class="lineno">15</span>   <span class="o">}</span>
<span class="lineno">16</span> <span class="o">}</span></code></pre></div>

<p><br>
Readers can get the code from <a href="/samples/Test.java">here</a>. Output of this sample is like below:</p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>javac Test.java
<span class="nv">$ </span>java -classpath /usr/share/java/jna/jna.jar:. Test

0x1000: push    rbp
0x1001: mov rax, qword ptr <span class="o">[</span>rip + 0x13b8<span class="o">]</span></code></pre></div>

<p><br>
The structure <strong>CsInsn</strong> exposes all the internal information about the disassembled instruction we are looking at. Some of the most used fields of this structure are presented below.</p>

<p><img src="/img/capstone-fields.png" alt="fields"></p>

<hr>

<h3>2. Architectures and modes</h3>

<p>At the moment, Capstone supports 8 hardware architectures with corresponding hardware modes, as follows.</p>

<p><img src="/img/capstone-archs.png" alt="archs"></p>

<p>Besides, there are few modes to be combined with basic modes above.</p>

<p><img src="/img/capstone-modes.png" alt="modes"></p>

<p>The way to combine extra modes with basic modes is to use the operand <code>+</code>. For example, the excerpt below initializes Capstone for Mips64 in <em>little endian</em> mode.</p>

<div class="highlight"><pre><code class="language-c" data-lang="c"><span class="n">Capstone</span> <span class="n">cs</span> <span class="o">=</span> <span class="n">new</span> <span class="n">Capstone</span><span class="p">(</span><span class="n">Capstone</span><span class="p">.</span><span class="n">CS_ARCH_MIPS</span><span class="p">,</span> <span class="n">Capstone</span><span class="p">.</span><span class="n">CS_MODE_64</span><span class="o">+</span><span class="n">Capstone</span><span class="p">.</span><span class="n">CS_MODE_LITTLE_ENDIAN</span><span class="p">);</span></code></pre></div>

<hr>

<h3>3. Set options</h3>

<p>Capstone lets we customize the engine at run-time, so we can set the assembly syntax or turn on detail information. </p>

<h4>3.1 Syntax option</h4>

<p>By default, X86 assembly outputs in Intel syntax. To switch to AT&amp;T syntax instead, we can simply set syntax option like below.</p>

<div class="highlight"><pre><code class="language-java" data-lang="java"><span class="n">md</span> <span class="o">=</span> <span class="n">capstone</span><span class="o">.</span><span class="na">Capstone</span><span class="o">(</span><span class="n">Capstone</span><span class="o">.</span><span class="na">CS_ARCH_X86</span><span class="o">,</span> <span class="n">Capstone</span><span class="o">.</span><span class="na">CS_MODE_32</span><span class="o">)</span>
<span class="n">md</span><span class="o">.</span><span class="na">setSyntax</span><span class="o">(</span><span class="n">Capstone</span><span class="o">.</span><span class="na">CS_OPT_SYNTAX_ATT</span><span class="o">)</span></code></pre></div>

<p><br>
In case we want to return to Intel syntax, we can reset the syntax in the similar way:</p>

<div class="highlight"><pre><code class="language-java" data-lang="java"><span class="n">md</span><span class="o">.</span><span class="na">setSyntax</span><span class="o">(</span><span class="n">Capstone</span><span class="o">.</span><span class="na">CS_OPT_SYNTAX_INTEL</span><span class="o">)</span></code></pre></div>

<h4>3.2 Turn on details</h4>

<p>By default, Capstone do not generate details for disassembled instruction. If we need information such as implicit registers read/written or semantic groups that this instruction belongs to, we need to explicitly turn this option <em>on</em>, like in the sample code below. However, keep in mind that this costs more memory, complicates the internal operations and slows down the engine a bit, so only do that if needed.</p>

<div class="highlight"><pre><code class="language-java" data-lang="java"><span class="n">md</span><span class="o">.</span><span class="na">setDetail</span><span class="o">(</span><span class="kc">true</span><span class="o">)</span></code></pre></div>

<p><br>
However, we can always reset the engine back to default state with similar method.</p>

<div class="highlight"><pre><code class="language-java" data-lang="java"><span class="n">md</span><span class="o">.</span><span class="na">setDetail</span><span class="o">(</span><span class="kc">false</span><span class="o">)</span></code></pre></div>

<hr>

<h3>4. More examples</h3>

<p>This tutorial does not explain all the API of Capstone yet. Please find more advanced examples in source of <em>Test*.java</em> files under Java binding directory <a href="https://github.com/aquynh/capstone/tree/master/bindings/java">bindings/java</a> in the Capstone source code.</p>

    </div>

    <div class="wrapper-footer">
      <div class="container">
        <footer class="footer">
          
<a href="mailto:capstone.engine@gmail.com"><i class="svg-icon email"></i></a>


<a href="https://github.com/aquynh/capstone"><i class="svg-icon github"></i></a>




<a href="https://www.twitter.com/capstone_engine"><i class="svg-icon twitter"></i></a>



        </footer>
      </div>
    </div>

    

  </body>
</html>
