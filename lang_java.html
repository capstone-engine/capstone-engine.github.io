<!DOCTYPE html><html><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><title>Capstone - Programming with Java language</title><link rel="stylesheet" href="css/style.css" type="text/css" media="all"><link rel="stylesheet" href="css/pygments.css" type="text/css" media="all"><link rel="alternate" href="feed/index.xml" type="application/atom+xml" title="Atom Feed"></head><body><div id="fb-root"></div> <script>!function(e,t,n){var c,o=e.getElementsByTagName(t)[0];e.getElementById(n)||(c=e.createElement(t),c.id=n,c.src="//connect.facebook.net/en_US/all.js#xfbml=1",o.parentNode.insertBefore(c,o))}(document,"script","facebook-jssdk")</script><script>!function(t,e,r){var n,s=t.getElementsByTagName(e)[0],i=/^http:/.test(t.location)?"http":"https";t.getElementById(r)||(n=t.createElement(e),n.id=r,n.src=i+"://platform.twitter.com/widgets.js",s.parentNode.insertBefore(n,s))}(document,"script","twitter-wjs")</script><script>!function(){var e=document.createElement("script");e.type="text/javascript",e.async=!0,e.src="https://apis.google.com/js/plusone.js";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}()</script><div class="page"> <header> <a href="index.html" id="cs_home">Capstone</a> <nav> <a href="index.html">Home</a> <a href="download.html">Download</a> <a href="documentation.html">Docs</a> <a href="showcase.html">Showcase</a> <a href="testimonial.html">Testimonials</a> <a href="donation.html">Donate</a> <a href="contact.html">Contact</a> </nav> </header> <section><h2 id="java-tutorial-for-capstone">Java tutorial for Capstone</h2><h3 id="basic-sample">1. Basic sample</h3><p>Capstone has a very simple API, so it is very easy to write tools using the framework. To start, the below code disassemble some X86 binary, and print out its assembly.</p><div class="highlight"><pre><code class="language-java" data-lang="java"><span class="lineno"> 1</span> <span class="c1">// Test.java</span>
<span class="lineno"> 2</span> <span class="kn">import</span> <span class="nn">capstone.Capstone</span><span class="o">;</span>
<span class="lineno"> 3</span>
<span class="lineno"> 4</span> <span class="kd">public</span> <span class="kd">class</span> <span class="nc">Test</span> <span class="o">{</span>
<span class="lineno"> 5</span>
<span class="lineno"> 6</span>   <span class="kd">public</span> <span class="kd">static</span> <span class="kt">byte</span> <span class="o">[]</span> <span class="n">CODE</span> <span class="o">=</span> <span class="o">{</span> <span class="mh">0x55</span><span class="o">,</span> <span class="mh">0x48</span><span class="o">,</span> <span class="o">(</span><span class="kt">byte</span><span class="o">)</span> <span class="mh">0x8b</span><span class="o">,</span> <span class="mh">0x05</span><span class="o">,</span> <span class="o">(</span><span class="kt">byte</span><span class="o">)</span> <span class="mh">0xb8</span><span class="o">,</span>
<span class="lineno"> 7</span>     <span class="mh">0x13</span><span class="o">,</span> <span class="mh">0x00</span><span class="o">,</span> <span class="mh">0x00</span> <span class="o">};</span>
<span class="lineno"> 8</span>
<span class="lineno"> 9</span>   <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span> <span class="n">argv</span><span class="o">[])</span> <span class="o">{</span>
<span class="lineno">10</span>     <span class="n">Capstone</span> <span class="n">cs</span> <span class="o">=</span> <span class="k">new</span> <span class="nf">Capstone</span><span class="o">(</span><span class="n">Capstone</span><span class="o">.</span><span class="na">CS_ARCH_X86</span><span class="o">,</span> <span class="n">Capstone</span><span class="o">.</span><span class="na">CS_MODE_64</span><span class="o">);</span>
<span class="lineno">11</span>     <span class="n">Capstone</span><span class="o">.</span><span class="na">CsInsn</span><span class="o">[]</span> <span class="n">allInsn</span> <span class="o">=</span> <span class="n">cs</span><span class="o">.</span><span class="na">disasm</span><span class="o">(</span><span class="n">CODE</span><span class="o">,</span> <span class="mh">0x1000</span><span class="o">);</span>
<span class="lineno">12</span>     <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="o">;</span> <span class="n">i</span><span class="o">&lt;</span><span class="n">allInsn</span><span class="o">.</span><span class="na">length</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span>
<span class="lineno">13</span>       <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">printf</span><span class="o">(</span><span class="s">"0x%x:\t%s\t%s\n"</span><span class="o">,</span> <span class="n">allInsn</span><span class="o">[</span><span class="n">i</span><span class="o">].</span><span class="na">address</span><span class="o">,</span>
<span class="lineno">14</span>           <span class="n">allInsn</span><span class="o">[</span><span class="n">i</span><span class="o">].</span><span class="na">mnemonic</span><span class="o">,</span> <span class="n">allInsn</span><span class="o">[</span><span class="n">i</span><span class="o">].</span><span class="na">opStr</span><span class="o">);</span>
<span class="lineno">15</span>   <span class="o">}</span>
<span class="lineno">16</span> <span class="o">}</span></code></pre></div><p><br/> Readers can get the code from <a href="/samples/Test.java">here</a>. Output of this sample is like below:</p><div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>javac Test.java
<span class="nv">$ </span>java -classpath /usr/share/java/jna/jna.jar:. Test

0x1000:	push	rbp
0x1001:	mov	rax, qword ptr <span class="o">[</span>rip + 0x13b8<span class="o">]</span></code></pre></div><p><br/></p><table><thead><tr><th>Field</th><th>Meaning</th></tr></thead><tbody><tr><td>address</td><td>Address of the instruction. This field has <em>int</em> type.</td></tr><tr><td>mnemonic</td><td>Mnemonic of the instruction. This field has <em>string</em> type.</td></tr><tr><td>opStr</td><td>Operands of the instruction. This field has <em>string</em> type.</td></tr></tbody></table><hr/><h3 id="architectures-and-modes">2. Architectures and modes</h3><p>At the moment, Capstone supports 8 hardware architectures with corresponding hardware modes, as followings.</p><p><br/></p><table><thead><tr><th>Architecture</th><th>Basic mode</th></tr></thead><tbody><tr><td>CS_ARCH_ARM<br/><em>ARM architecture</em></td><td>CS_MODE_ARM: <em>Arm mode</em><br/>CS_MODE_THUMB: <em>Thumb mode</em></td></tr><tr><td>CS_ARCH_ARM64<br/><em>ARMv8/AArch64 architecture</em></td><td>CS_MODE_ARM: <em>default mode</em></td></tr><tr><td>CS_ARCH_MIPS<br/><em>Mips architecture</em></td><td>CS_MODE_MIPS32: <em>Mips32 mode</em><br/>CS_MODE_MIPS64: <em>Mips64 mode</em><br/>CS_MODE_MIPS32R6: <em>Mips32R6 mode</em></td></tr><tr><td>CS_ARCH_PPC<br/><em>PowerPC architecture</em></td><td>CS_MODE_32: <em>32-bit mode</em><br/>CS_MODE_64: <em>64-bit mode</em></td></tr><tr><td>CS_ARCH_SPARC<br/><em>Sparc architecture</em></td><td> </td></tr><tr><td>CS_ARCH_SYSZ<br/><em>SystemZ architecture</em></td><td> </td></tr><tr><td>CS_ARCH_X86<br/><em>X86 architecture</em></td><td>CS_MODE_16: <em>16-bit mode</em><br/>CS_MODE_32: <em>32-bit mode</em><br/>CS_MODE_64: <em>64-bit mode</em></td></tr><tr><td>CS_ARCH_XCORE<br/><em>XCore architecture</em></td><td> </td></tr></tbody></table><p><br/> Besides, there are few modes to be combined with basic modes above.</p><table><thead><tr><th>Extra mode</th><th>Combined with</th></tr></thead><tbody><tr><td>CS_MODE_LITTLE_ENDIAN<br/><em>Little endian mode</em></td><td>CS_MODE_ARM, CS_MODE_THUMB, CS_MODE_32, CS_MODE_64, CS_MODE_MIPS32, CS_MODE_MIPS64, CS_MODE_MIPS32R6</td></tr><tr><td>CS_MODE_BIG_ENDIAN<br/><em>Big endian mode</em></td><td>CS_MODE_ARM, CS_MODE_THUMB, CS_MODE_32, CS_MODE_64, CS_MODE_MIPS32, CS_MODE_MIPS64, CS_MODE_MIPS32R6</td></tr><tr><td>CS_MODE_MICRO<br/><em>MicroMips mode</em></td><td>CS_MODE_MIPS32, CS_MODE_MIPS64, CS_MODE_MIPS32R6</td></tr><tr><td>CS_MODE_MCLASS<br/><em>MClass mode</em></td><td>CS_MODE_ARM</td></tr><tr><td>CS_MODE_V8<br/><em>ARM V8 mode</em></td><td>CS_MODE_ARM, CS_MODE_THUMB</td></tr><tr><td>CS_MODE_V9<br/><em>Sparc V9 mode</em></td><td>CS_MODE_BIG_ENDIAN</td></tr></tbody></table><p><br/> The way to combine extra modes with basic modes is to use the operand <code>+</code>. For example, the excerpt below initializes Capstone for Mips64 in <em>little endian</em> mode.</p><div class="highlight"><pre><code class="language-c" data-lang="c"><span class="n">Capstone</span> <span class="n">cs</span> <span class="o">=</span> <span class="n">new</span> <span class="n">Capstone</span><span class="p">(</span><span class="n">Capstone</span><span class="p">.</span><span class="n">CS_ARCH_MIPS</span><span class="p">,</span> <span class="n">Capstone</span><span class="p">.</span><span class="n">CS_MODE_64</span><span class="o">+</span><span class="n">Capstone</span><span class="p">.</span><span class="n">CS_MODE_LITTLE_ENDIAN</span><span class="p">);</span></code></pre></div><hr/><h3 id="set-options">3. Set options</h3><p>Capstone lets we customize the engine at run-time, so we can set the assembly syntax or turn on detail information.</p><h4 id="syntax-option">3.1 Syntax option</h4><p>By default, X86 assembly outputs in Intel syntax. To switch to AT&amp;T syntax instead, we can simply set syntax option like below.</p><div class="highlight"><pre><code class="language-java" data-lang="java"><span class="n">md</span> <span class="o">=</span> <span class="n">capstone</span><span class="o">.</span><span class="na">Capstone</span><span class="o">(</span><span class="n">Capstone</span><span class="o">.</span><span class="na">CS_ARCH_X86</span><span class="o">,</span> <span class="n">Capstone</span><span class="o">.</span><span class="na">CS_MODE_32</span><span class="o">)</span>
<span class="n">md</span><span class="o">.</span><span class="na">setSyntax</span><span class="o">(</span><span class="n">Capstone</span><span class="o">.</span><span class="na">CS_OPT_SYNTAX_ATT</span><span class="o">)</span></code></pre></div><p><br/> In case we want to return to Intel syntax, we can reset the syntax in the similar way:</p><div class="highlight"><pre><code class="language-java" data-lang="java"><span class="n">md</span><span class="o">.</span><span class="na">setSyntax</span><span class="o">(</span><span class="n">Capstone</span><span class="o">.</span><span class="na">CS_OPT_SYNTAX_INTEL</span><span class="o">)</span></code></pre></div><h4 id="turn-on-details">3.2 Turn on details</h4><p>By default, Capstone do not generate details for disassembled instruction. If we need information such as implicit registers read/written or semantic groups that this instruction belongs to, we need to explicitly turn this option <em>on</em>, like in the sample code below. However, keep in mind that this costs more memory, complicates the internal operations and slows down the engine a bit, so only do that if needed.</p><div class="highlight"><pre><code class="language-java" data-lang="java"><span class="n">md</span><span class="o">.</span><span class="na">setDetail</span><span class="o">(</span><span class="kc">true</span><span class="o">)</span></code></pre></div><p><br/> However, we can always reset the engine back to default state with similar method.</p><div class="highlight"><pre><code class="language-java" data-lang="java"><span class="n">md</span><span class="o">.</span><span class="na">setDetail</span><span class="o">(</span><span class="kc">false</span><span class="o">)</span></code></pre></div><hr/><h3 id="more-examples">4. More examples</h3><p>This tutorial does not explain all the API of Capstone yet. Please find more advanced examples in source of <em>Test*.java</em> files under Java binding directory <a href="https://github.com/aquynh/capstone/tree/master/bindings/java">bindings/java</a> in the Capstone source code.</p></section> <footer> </footer></div></body></html>