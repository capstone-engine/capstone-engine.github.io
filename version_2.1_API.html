<!DOCTYPE html><html><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><title>Capstone - Version 2.0</title><link rel="stylesheet" href="css/style.css" type="text/css" media="all"><link rel="stylesheet" href="css/pygments.css" type="text/css" media="all"><link rel="alternate" href="feed/index.xml" type="application/atom+xml" title="Atom Feed"></head><body><div id="fb-root"></div> <script>!function(e,t,n){var c,o=e.getElementsByTagName(t)[0];e.getElementById(n)||(c=e.createElement(t),c.id=n,c.src="//connect.facebook.net/en_US/all.js#xfbml=1",o.parentNode.insertBefore(c,o))}(document,"script","facebook-jssdk")</script><script>!function(t,e,r){var n,s=t.getElementsByTagName(e)[0],i=/^http:/.test(t.location)?"http":"https";t.getElementById(r)||(n=t.createElement(e),n.id=r,n.src=i+"://platform.twitter.com/widgets.js",s.parentNode.insertBefore(n,s))}(document,"script","twitter-wjs")</script><script>!function(){var e=document.createElement("script");e.type="text/javascript",e.async=!0,e.src="https://apis.google.com/js/plusone.js";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}()</script><div class="page"> <header> <a href="index.html" id="cs_home">Capstone</a> <nav> <a href="index.html">Home</a> <a href="download.html">Download</a> <a href="documentation.html">Docs</a> <a href="showcase.html">Showcase</a> <a href="testimonial.html">Testimonials</a> <a href="donate.html">Donate</a> <a href="contact.html">Contact</a> </nav> </header> <section><h2 id="changes-from-20-to-21">Changes from 2.0 to 2.1</h2><p>This documentation describes how to adapt code written for Capstone version <em>2.0</em> to version <strong>2.1</strong>. Fortunately, the changes to be made are trivial, if any:</p><ul><li><p>Tools written in C just need some minimal modification to one API (see section 1).</p></li><li><p>Code developed in other binding languages (Java, Python) do not need any change. The bindings must be upgraded, however (see section 2).</p></li></ul><hr/><p>### 1. API change</p><p>Version 2.1 changes the API <strong>cs_close()</strong> from prototype:</p><div class="highlight"><pre><code class="language-c" data-lang="c"><span class="n">cs_err</span> <span class="nf">cs_close</span><span class="p">(</span><span class="n">csh</span> <span class="n">handle</span><span class="p">);</span>   <span class="c1">// in 2.0, cs_close() used to take handle as argument.</span></code></pre></div><p>to:</p><div class="highlight"><pre><code class="language-c" data-lang="c"><span class="n">cs_err</span> <span class="nf">cs_close</span><span class="p">(</span><span class="n">csh</span> <span class="o">*</span><span class="n">handle</span><span class="p">);</span>  <span class="c1">// &lt;-- now cs_close() takes pointer to handle as argument.</span></code></pre></div><p><br/> Therefore, all C code written on top of Capstone must be fixed accordingly, from something like:</p><div class="highlight"><pre><code class="language-c" data-lang="c"><span class="n">csh</span> <span class="n">handle</span><span class="p">;</span>
    <span class="c1">//....</span>
    <span class="n">cs_close</span><span class="p">(</span><span class="n">handle</span><span class="p">);</span>   <span class="c1">// in 2.0, cs_close() used to take handle as argument.</span></code></pre></div><p>to:</p><div class="highlight"><pre><code class="language-c" data-lang="c"><span class="n">csh</span> <span class="n">handle</span><span class="p">;</span>
    <span class="c1">//....</span>
    <span class="n">cs_close</span><span class="p">(</span><span class="o">&amp;</span><span class="n">handle</span><span class="p">);</span>  <span class="c1">// &lt;-- now cs_close() takes pointer to handle as argument.</span></code></pre></div><p><br/> Internally, this change is to invalidate @handle, making sure it cannot be mistakenly used after the handle is closed.</p><p><br/> <code>NOTE</code>: this change <strong>breaks backward compatibility for C code only</strong>. All the bindings of Python, Java or bindings made by community, such as C#, Go, Ruby &amp; Vala, should hide this change behind their API. For this reason, code using these bindings still work exactly like before and do not need to have any modification.</p><hr/><p>### 2. Upgrade bindings</p><p>Version 2.1 makes some changes to Java &amp; Python bindings, like adding some new instructions (affecting *_const.py &amp; *_const.java). While this <em>does not break API compatibility</em> (i.e users do not need to modify their program written with prior version 2.0), they <strong>must upgrade these bindings</strong> and <strong>must not use the old bindings from prior versions</strong>.</p><p><br/> We cannot emphasize this enough: When upgrading to the new engine, <strong>always upgrade to the bindings coming with the same core</strong>. If you do not follow this principle, applications written with old bindings would run with the new incompatible core, thus silently break without any clear evidence, making it extremely hard to debug.</p></section> <footer> </footer></div></body></html>